<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test de Descargas</title>
</head>
<body>
    <h1>Test de Descargas PDF</h1>
    <button id="testDownload">Probar Descarga</button>
    
    <script>
        document.getElementById('testDownload').addEventListener('click', async () => {
            try {
                // Simular contenido PDF
                const pdfContent = '%PDF-1.4\n1 0 obj\n<<\n/Type /Catalog\n/Pages 2 0 R\n>>\nendobj\n\n2 0 obj\n<<\n/Type /Pages\n/Kids [3 0 R]\n/Count 1\n>>\nendobj\n\n3 0 obj\n<<\n/Type /Page\n/Parent 2 0 R\n/MediaBox [0 0 612 792]\n/Contents 4 0 R\n>>\nendobj\n\n4 0 obj\n<<\n/Length 44\n>>\nstream\nBT\n/F1 12 Tf\n72 720 Td\n(Test PDF) Tj\nET\nendstream\nendobj\n\nxref\n0 5\n0000000000 65535 f \n0000000010 00000 n \n0000000053 00000 n \n0000000125 00000 n \n0000000185 00000 n \ntrailer\n<<\n/Size 5\n/Root 1 0 R\n>>\nstartxref\n238\n%%EOF';
                
                const blob = new Blob([pdfContent], { type: 'application/pdf' });
                const fileName = 'Test-Carta-Descarga.pdf';
                
                console.log('ðŸ”½ Iniciando descarga de prueba:', fileName);
                
                // MÃ©todo mejorado
                const url = window.URL.createObjectURL(blob);
                const link = document.createElement('a');
                
                link.href = url;
                link.download = fileName;
                link.style.display = 'none';
                link.setAttribute('download', fileName);
                
                document.body.appendChild(link);
                
                // Click con evento personalizado
                const clickEvent = new MouseEvent('click', {
                    view: window,
                    bubbles: true,
                    cancelable: true
                });
                
                link.dispatchEvent(clickEvent);
                
                setTimeout(() => {
                    document.body.removeChild(link);
                    window.URL.revokeObjectURL(url);
                    console.log('âœ… Descarga completada:', fileName);
                    alert('Descarga completada: ' + fileName);
                }, 200);
                
            } catch (error) {
                console.error('Error:', error);
                alert('Error: ' + error.message);
            }
        });
    </script>
</body>
</html>
